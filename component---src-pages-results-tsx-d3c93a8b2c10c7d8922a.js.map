{"version":3,"file":"component---src-pages-results-tsx-d3c93a8b2c10c7d8922a.js","mappings":"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","sources":["webpack://picapica-web-client/./src/elements/center-align-two.tsx","webpack://picapica-web-client/./src/lib/use-collection-localization.ts","webpack://picapica-web-client/./src/elements/labels.tsx","webpack://picapica-web-client/./src/elements/loader-animation.tsx","webpack://picapica-web-client/./src/lib/session/result-categories.ts","webpack://picapica-web-client/./src/elements/badge.tsx","webpack://picapica-web-client/./src/elements/results-overview.tsx","webpack://picapica-web-client/./src/elements/group.tsx","webpack://picapica-web-client/./src/elements/step-selector.tsx","webpack://picapica-web-client/./src/lib/session/util.ts","webpack://picapica-web-client/./src/lib/session/analysis-config.ts","webpack://picapica-web-client/./src/lib/use-analysis-config.ts","webpack://picapica-web-client/./src/lib/use-collection-document.ts","webpack://picapica-web-client/./src/lib/use-collections.ts","webpack://picapica-web-client/./src/lib/use-compute-results.ts","webpack://picapica-web-client/./src/pages/results.tsx"],"sourcesContent":["import React from \"react\";\nimport \"./center-align-two.scss\";\n\nexport interface CenterAlignTwoProps {\n\treadonly className?: string;\n\treadonly grow: \"left\" | \"right\";\n\treadonly left: React.ReactNode;\n\treadonly right: React.ReactNode;\n}\n\nexport function CenterAlignTwo({ className, grow, left, right }: CenterAlignTwoProps): JSX.Element {\n\treturn (\n\t\t<div className={\"CenterAlignTwo\" + (className ? \" \" + className : \"\")}>\n\t\t\t<div className={`left${grow === \"left\" ? \" grow\" : \"\"}`}>{left}</div>\n\t\t\t<div className={`right${grow === \"right\" ? \" grow\" : \"\"}`}>{right}</div>\n\t\t</div>\n\t);\n}\n","import { Locales } from \"./localization\";\nimport { PicapicaUrn } from \"./session/urn\";\nimport { useLocalization } from \"./use-localization\";\n\nexport interface CollectionLocalization {\n\treadonly title: string;\n}\n\ntype KnownCollections = \"core_fulltext_languagenameenglish\";\n\nconst knownCollections: Locales<Record<KnownCollections, CollectionLocalization>> = {\n\ten: {\n\t\tcore_fulltext_languagenameenglish: {\n\t\t\ttitle: \"CORE - The world's largest collection of open-access research papers\",\n\t\t},\n\t},\n\tde: {\n\t\tcore_fulltext_languagenameenglish: {\n\t\t\ttitle: \"CORE - The world's largest collection of open-access research papers\",\n\t\t},\n\t},\n};\n\nconst EMPTY_OBJ = {};\n\nexport function useCollectionLocalization(\n\turn: PicapicaUrn | string | undefined | null\n): Partial<CollectionLocalization> {\n\tconst l: Readonly<Record<string, CollectionLocalization | undefined>> = useLocalization(knownCollections);\n\n\tconst parsed = typeof urn === \"string\" ? PicapicaUrn.tryParse(urn) : urn;\n\tif (parsed && parsed.type === \"collection\") {\n\t\tconst known = l[parsed.collectionId];\n\t\tif (known) {\n\t\t\treturn known;\n\t\t}\n\t}\n\n\treturn EMPTY_OBJ;\n}\n","import React from \"react\";\nimport { Collection } from \"../lib/generated/v1/types_pb\";\nimport { Locales, SimpleString } from \"../lib/localization\";\nimport { PicapicaCollectionUrn, PicapicaUrn, Urn } from \"../lib/session/urn\";\nimport { useCollectionLocalization } from \"../lib/use-collection-localization\";\nimport { useLocalization } from \"../lib/use-localization\";\nimport { DeepReadonly } from \"../lib/util\";\nimport { PicaIcon, PicaIconKind } from \"./icon\";\nimport \"./labels.scss\";\n\nexport interface LabelProps {\n\treadonly icon?: PicaIconKind;\n\treadonly text: string;\n}\n\nexport function Label(props: LabelProps): JSX.Element {\n\treturn (\n\t\t<span className=\"Label\">\n\t\t\t{props.icon && <PicaIcon kind={props.icon} />}\n\t\t\t<span className=\"text\">{props.text}</span>\n\t\t</span>\n\t);\n}\n\nexport function SubmittedFilesLabel(): JSX.Element {\n\tconst l = useLocalization(locales);\n\treturn <Label icon=\"upload\" text={l.submittedFiles} />;\n}\n\nexport type CollectionProps =\n\t| {\n\t\t\treadonly collectionUrn: string | PicapicaCollectionUrn;\n\t\t\treadonly collections?: DeepReadonly<Collection.AsObject[]>;\n\t  }\n\t| {\n\t\t\treadonly collection: DeepReadonly<Collection.AsObject>;\n\t  };\n\nexport function CollectionLabel(props: CollectionProps): JSX.Element {\n\tconst { urn, collection } = processProps(props);\n\tconst { title } = useCollectionLocalization(urn);\n\n\tif (title) {\n\t\treturn <Label text={title} />;\n\t} else if (collection?.properties) {\n\t\treturn <Label text={`${collection.properties.name} - ${collection.properties.description}`} />;\n\t} else {\n\t\treturn <UnknownCollectionLabel />;\n\t}\n}\ninterface ProcessedProps {\n\turn: PicapicaCollectionUrn | undefined;\n\tcollection: DeepReadonly<Collection.AsObject> | undefined;\n}\nfunction processProps(props: CollectionProps): ProcessedProps {\n\tif (\"collection\" in props) {\n\t\treturn {\n\t\t\turn: PicapicaUrn.parse(props.collection.urn as Urn<\"collection\">),\n\t\t\tcollection: props.collection,\n\t\t};\n\t} else {\n\t\tlet urn: PicapicaCollectionUrn;\n\t\tlet urnString: string;\n\t\tif (typeof props.collectionUrn === \"string\") {\n\t\t\tconst parsed = PicapicaUrn.tryParse(props.collectionUrn);\n\t\t\tif (!parsed || parsed.type !== \"collection\") {\n\t\t\t\treturn { urn: undefined, collection: undefined };\n\t\t\t}\n\t\t\turn = parsed;\n\t\t\turnString = props.collectionUrn;\n\t\t} else {\n\t\t\turn = props.collectionUrn;\n\t\t\turnString = PicapicaUrn.stringify(urn);\n\t\t}\n\n\t\tconst collection = props.collections?.find(c => c.urn === urnString);\n\n\t\treturn { urn, collection };\n\t}\n}\n\nfunction UnknownCollectionLabel(): JSX.Element {\n\tconst l = useLocalization(locales);\n\treturn <Label text={l.unknown} />;\n}\n\nconst locales: Locales<SimpleString<\"submittedFiles\" | \"unknown\">> = {\n\ten: {\n\t\tsubmittedFiles: \"Your submitted files\",\n\t\tunknown: \"Unknown\",\n\t},\n\tde: {\n\t\tsubmittedFiles: \"Ihre eingereichten Dateien\",\n\t\tunknown: \"Unbekannt\",\n\t},\n};\n","import React from \"react\";\nimport { Icon } from \"./icon\";\nimport \"./loader-animation.scss\";\n\nexport interface LoaderAnimationProps {\n\treadonly id?: string;\n}\n\nexport function LoaderAnimation({ id }: LoaderAnimationProps): JSX.Element {\n\treturn (\n\t\t<span className=\"LoaderAnimation\" id={id}>\n\t\t\t{\" \"}\n\t\t\t<Icon kind=\"loader-5-line\" />\n\t\t\t<Icon kind=\"loader-5-line\" />\n\t\t</span>\n\t);\n}\n","import { Result } from \"../generated/v1/types_pb\";\nimport { DeepReadonly } from \"../util\";\nimport { PicapicaDocumentUrn, PicapicaItemUrn, PicapicaUrn, Urn } from \"./urn\";\n\nexport interface ItemResult {\n\treadonly a: PicapicaItemUrn;\n\treadonly b: PicapicaItemUrn;\n\treadonly result: DeepReadonly<Result.AsObject>;\n}\nexport interface CollectionResult {\n\treadonly item: PicapicaItemUrn;\n\treadonly document: PicapicaDocumentUrn;\n\treadonly result: DeepReadonly<Result.AsObject>;\n}\n\nexport interface ResultCategories {\n\t/**\n\t * A list of all results between items.\n\t */\n\titems: ItemResult[];\n\t/**\n\t * A map from a collections URN to a non-empty list of results between an item and a document from key collection.\n\t */\n\tcollections: Map<Urn<\"collection\">, CollectionResult[]>;\n\t/**\n\t * A list of results that are invalid by not having valid URNs.\n\t */\n\tinvalid: DeepReadonly<Result.AsObject>[];\n}\n\nexport function categorizeResults(results: Iterable<DeepReadonly<Result.AsObject>>): ResultCategories {\n\tconst categories: ResultCategories = { items: [], collections: new Map(), invalid: [] };\n\n\tfunction addDocument(\n\t\titem: PicapicaItemUrn,\n\t\tdocument: PicapicaDocumentUrn,\n\t\tresult: DeepReadonly<Result.AsObject>\n\t): void {\n\t\tconst collectionUrn = PicapicaUrn.stringify({ type: \"collection\", collectionId: document.collectionId });\n\n\t\tlet list = categories.collections.get(collectionUrn);\n\t\tif (list === undefined) {\n\t\t\tlist = [];\n\t\t\tcategories.collections.set(collectionUrn, list);\n\t\t}\n\t\tlist.push({ item, document, result });\n\t}\n\n\tfor (const result of results) {\n\t\tconst a = PicapicaUrn.tryParse(result.resources?.urnA ?? \"\");\n\t\tconst b = PicapicaUrn.tryParse(result.resources?.urnB ?? \"\");\n\n\t\tif (!a || !b) {\n\t\t\tcategories.invalid.push(result);\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (a.type === \"item\" && b.type === \"item\") {\n\t\t\tcategories.items.push({ a, b, result });\n\t\t} else if (a.type === \"item\" && b.type === \"document\") {\n\t\t\taddDocument(a, b, result);\n\t\t} else if (a.type === \"document\" && b.type === \"item\") {\n\t\t\taddDocument(b, a, result);\n\t\t} else {\n\t\t\tcategories.invalid.push(result);\n\t\t}\n\t}\n\n\treturn categories;\n}\n","import React from \"react\";\nimport \"./badge.scss\";\n\nexport type BadgeKind = \"Dark\" | \"Light\";\n\nexport interface BadgeProps {\n\treadonly kind: BadgeKind;\n}\n\nexport function Badge({ kind, children }: React.PropsWithChildren<BadgeProps>): JSX.Element {\n\treturn <span className={`Badge ${kind}`}>{children}</span>;\n}\n","import { Link } from \"gatsby\";\nimport React from \"react\";\nimport { Session } from \"../lib/generated/v1/services_pb\";\nimport { Collection, Result } from \"../lib/generated/v1/types_pb\";\nimport { Locales, SimpleString } from \"../lib/localization\";\nimport { categorizeResults, CollectionResult } from \"../lib/session/result-categories\";\nimport { PicapicaUrn, Urn } from \"../lib/session/urn\";\nimport { useCollectionDocument, usePreloadCollectionDocuments } from \"../lib/use-collection-document\";\nimport { useLocalization } from \"../lib/use-localization\";\nimport { DeepReadonly } from \"../lib/util\";\nimport { Badge } from \"./badge\";\nimport { Buttons } from \"./buttons\";\nimport { CenterAlignTwo } from \"./center-align-two\";\nimport { PicaIcon } from \"./icon\";\nimport { CollectionLabel, Label, SubmittedFilesLabel } from \"./labels\";\nimport { LoaderAnimation } from \"./loader-animation\";\nimport \"./results-overview.scss\";\n\nexport interface OverviewContainerProps {\n\treadonly backTo?: string;\n\treadonly title: React.ReactNode;\n}\n\nexport function OverviewContainer({\n\tbackTo,\n\ttitle,\n\tchildren,\n}: React.PropsWithChildren<OverviewContainerProps>): JSX.Element {\n\tconst l = useLocalization(locales);\n\n\treturn (\n\t\t<div className=\"OverviewContainer\">\n\t\t\t<div className=\"head\">\n\t\t\t\t{backTo && (\n\t\t\t\t\t<Link className={Buttons.BUTTON} to={backTo} title={l.back}>\n\t\t\t\t\t\t<PicaIcon kind=\"back\" />\n\t\t\t\t\t</Link>\n\t\t\t\t)}\n\t\t\t\t<div>{title}</div>\n\t\t\t</div>\n\t\t\t<div className=\"content\">{children}</div>\n\t\t</div>\n\t);\n}\n\nexport interface ResultsOverviewProps {\n\treadonly session: DeepReadonly<Session.AsObject>;\n\treadonly collections?: DeepReadonly<Collection.AsObject[]>;\n\treadonly selectedCollections: readonly Urn<\"collection\">[];\n\treadonly backTo: string;\n\treadonly itemTo: string;\n\treadonly collectionTo: (collectionUrn: string) => string;\n}\n\nexport function ResultsOverview({\n\tsession,\n\tcollections,\n\tselectedCollections,\n\tbackTo,\n\titemTo,\n\tcollectionTo,\n}: ResultsOverviewProps): JSX.Element {\n\tconst l = useLocalization(locales);\n\n\tconst categories = categorizeResults(session.resultsList);\n\n\t// add selected collections\n\tfor (const collection of selectedCollections) {\n\t\tcategories.collections.set(collection, categories.collections.get(collection) ?? []);\n\t}\n\n\tif (categories.invalid.length) {\n\t\tconsole.error(\"Not displaying the following results:\");\n\t\tconsole.error(categories.invalid);\n\t}\n\n\tconst title = (\n\t\t<CenterAlignTwo\n\t\t\tgrow=\"left\"\n\t\t\tleft={<Label icon=\"results\" text={l.analysisResults} />}\n\t\t\tright={<Badge kind=\"Dark\">{l.results}</Badge>}\n\t\t/>\n\t);\n\n\tconst running = session.status === Session.ComputeStatus.STATUS_RUNNING;\n\n\treturn (\n\t\t<div className=\"ResultsOverview\">\n\t\t\t<OverviewContainer backTo={backTo} title={title}>\n\t\t\t\t<div>\n\t\t\t\t\t<Link className={Buttons.BUTTON} to={itemTo}>\n\t\t\t\t\t\t<CenterAlignTwo\n\t\t\t\t\t\t\tgrow=\"left\"\n\t\t\t\t\t\t\tleft={<SubmittedFilesLabel />}\n\t\t\t\t\t\t\tright={\n\t\t\t\t\t\t\t\t<Badge kind=\"Light\">\n\t\t\t\t\t\t\t\t\t{running && <LoaderAnimation />}\n\t\t\t\t\t\t\t\t\t{categories.items.length}\n\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</Link>\n\t\t\t\t</div>\n\t\t\t\t{[...categories.collections].map(([urn, results]) => {\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<div key={urn}>\n\t\t\t\t\t\t\t<PreloadDocument sessionUrn={session.urn} results={results} />\n\t\t\t\t\t\t\t<Link className={Buttons.BUTTON} to={collectionTo(urn)}>\n\t\t\t\t\t\t\t\t<CenterAlignTwo\n\t\t\t\t\t\t\t\t\tgrow=\"left\"\n\t\t\t\t\t\t\t\t\tleft={<CollectionLabel collectionUrn={urn} collections={collections} />}\n\t\t\t\t\t\t\t\t\tright={<Badge kind=\"Light\">{results.length}</Badge>}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t);\n\t\t\t\t})}\n\t\t\t</OverviewContainer>\n\t\t</div>\n\t);\n}\n\nfunction PreloadDocument({ sessionUrn, results }: { sessionUrn: string; results: CollectionResult[] }): JSX.Element {\n\tusePreloadCollectionDocuments(\n\t\tsessionUrn,\n\t\tresults.map(r => PicapicaUrn.stringify(r.document))\n\t);\n\treturn <></>;\n}\n\nexport interface ItemResultsOverviewProps {\n\treadonly session: DeepReadonly<Session.AsObject>;\n\treadonly backTo: string;\n\treadonly resultTo: (result: DeepReadonly<Result.AsObject>) => string;\n}\n\nexport function ItemResultsOverview({ session, backTo, resultTo }: ItemResultsOverviewProps): JSX.Element {\n\tconst l = useLocalization(locales);\n\n\tconst { items } = categorizeResults(session.resultsList);\n\n\tconst title = (\n\t\t<CenterAlignTwo grow=\"left\" left={<SubmittedFilesLabel />} right={<Badge kind=\"Dark\">{l.matches}</Badge>} />\n\t);\n\n\tconst itemNameMap = new Map(session.itemsList.map(item => [item.urn, item.meta?.name]));\n\n\treturn (\n\t\t<div className=\"ItemResultsOverview\">\n\t\t\t<OverviewContainer backTo={backTo} title={title}>\n\t\t\t\t{items.map(({ result }) => {\n\t\t\t\t\tconst leftName = itemNameMap.get(result.resources?.urnA ?? \"\") ?? l.unknownItem;\n\t\t\t\t\tconst rightName = itemNameMap.get(result.resources?.urnB ?? \"\") ?? l.unknownItem;\n\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<div key={result.urn}>\n\t\t\t\t\t\t\t<Link className={Buttons.BUTTON} to={resultTo(result)}>\n\t\t\t\t\t\t\t\t<CenterAlignTwo\n\t\t\t\t\t\t\t\t\tgrow=\"left\"\n\t\t\t\t\t\t\t\t\tleft={\n\t\t\t\t\t\t\t\t\t\t<span className=\"item-vs\">\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"left\">{leftName}</span>\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"vs\">vs.</span>\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"right\">{rightName}</span>\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tright={\n\t\t\t\t\t\t\t\t\t\tsession.status === Session.ComputeStatus.STATUS_COMPLETED ? (\n\t\t\t\t\t\t\t\t\t\t\t<Badge kind=\"Light\">{result.seedsList.length}</Badge>\n\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t<LoaderAnimation />\n\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t);\n\t\t\t\t})}\n\n\t\t\t\t{items.length === 0 && <div className=\"no-results\">{l.noResults}</div>}\n\t\t\t</OverviewContainer>\n\t\t</div>\n\t);\n}\n\nexport interface CollectionResultsOverviewProps {\n\treadonly collectionUrn: string;\n\treadonly session: DeepReadonly<Session.AsObject>;\n\treadonly collections?: DeepReadonly<Collection.AsObject[]>;\n\treadonly backTo: string;\n\treadonly resultTo: (result: DeepReadonly<Result.AsObject>) => string;\n}\n\nexport function CollectionResultsOverview({\n\tsession,\n\tcollectionUrn,\n\tcollections,\n\tbackTo,\n\tresultTo,\n}: CollectionResultsOverviewProps): JSX.Element {\n\tconst l = useLocalization(locales);\n\n\tconst results = categorizeResults(session.resultsList).collections.get(collectionUrn as Urn<\"collection\">) ?? [];\n\n\tconst title = (\n\t\t<CenterAlignTwo\n\t\t\tgrow=\"left\"\n\t\t\tleft={<CollectionLabel collectionUrn={collectionUrn} collections={collections} />}\n\t\t\tright={<Badge kind=\"Dark\">{l.matches}</Badge>}\n\t\t/>\n\t);\n\n\tconst itemNameMap = new Map(session.itemsList.map(item => [item.urn, item.meta?.name]));\n\n\treturn (\n\t\t<div className=\"CollectionResultsOverview\">\n\t\t\t<OverviewContainer backTo={backTo} title={title}>\n\t\t\t\t{results.map(({ item, document, result }) => {\n\t\t\t\t\tconst itemName = itemNameMap.get(PicapicaUrn.stringify(item)) ?? l.unknownItem;\n\t\t\t\t\tconst documentName = (\n\t\t\t\t\t\t<DocumentName sessionUrn={session.urn} urn={PicapicaUrn.stringify(document)} />\n\t\t\t\t\t);\n\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<div key={result.urn}>\n\t\t\t\t\t\t\t<Link className={Buttons.BUTTON} to={resultTo(result)}>\n\t\t\t\t\t\t\t\t<CenterAlignTwo\n\t\t\t\t\t\t\t\t\tgrow=\"left\"\n\t\t\t\t\t\t\t\t\tleft={\n\t\t\t\t\t\t\t\t\t\t<span className=\"item-vs\">\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"left\">{itemName}</span>\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"vs\">vs.</span>\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"right\">{documentName}</span>\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tright={\n\t\t\t\t\t\t\t\t\t\tsession.status === Session.ComputeStatus.STATUS_COMPLETED ? (\n\t\t\t\t\t\t\t\t\t\t\t<Badge kind=\"Light\">{result.seedsList.length}</Badge>\n\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t<LoaderAnimation />\n\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t);\n\t\t\t\t})}\n\n\t\t\t\t{results.length === 0 && <div className=\"no-results\">{l.noResults}</div>}\n\t\t\t</OverviewContainer>\n\t\t</div>\n\t);\n}\n\nfunction DocumentName({ sessionUrn, urn }: { sessionUrn: string; urn: Urn<\"document\"> }): JSX.Element {\n\tconst document = useCollectionDocument(sessionUrn, urn);\n\tif (document?.properties) {\n\t\treturn <>{document.properties?.title}</>;\n\t}\n\treturn <LoaderAnimation />;\n}\n\nconst locales: Locales<SimpleString<\"back\" | \"analysisResults\" | \"results\" | \"matches\" | \"noResults\" | \"unknownItem\">> =\n\t{\n\t\ten: {\n\t\t\tback: \"Back\",\n\n\t\t\tanalysisResults: \"Analysis results\",\n\t\t\tresults: \"Results\",\n\t\t\tmatches: \"Matches\",\n\t\t\tnoResults: \"No results\",\n\n\t\t\tunknownItem: \"<unknown>\",\n\t\t},\n\t\tde: {\n\t\t\tback: \"Zur√ºck\",\n\n\t\t\tanalysisResults: \"Analyse\\xADergebnisse\",\n\t\t\tresults: \"Ergebnisse\",\n\t\t\tmatches: \"Treffer\",\n\t\t\tnoResults: \"Keine Ergebnisse\",\n\n\t\t\tunknownItem: \"<unbekannt>\",\n\t\t},\n\t};\n","import React from \"react\";\nimport \"./group.scss\";\n\nexport interface GroupProps {\n\treadonly heading: React.ReactNode;\n}\n\nexport function Group({ heading, children }: React.PropsWithChildren<GroupProps>): JSX.Element {\n\treturn (\n\t\t<div className=\"Group\">\n\t\t\t<div className=\"group-heading\">{heading}</div>\n\t\t\t<div className=\"group-container\">{children}</div>\n\t\t</div>\n\t);\n}\n","import { Link } from \"gatsby\";\nimport React from \"react\";\nimport { Locales, SimpleString } from \"../lib/localization\";\nimport { toAnalysis, toResults, toSubmit } from \"../lib/page-links\";\nimport { useLocalization } from \"../lib/use-localization\";\nimport { assertNever } from \"../lib/util\";\nimport { Buttons } from \"./buttons\";\nimport { Group } from \"./group\";\nimport { PicaIcon, PicaIconKind } from \"./icon\";\nimport \"./step-selector.scss\";\n\nexport type StepKind = \"submit\" | \"analysis\" | \"checkout\" | \"results\";\n\nexport function getLinkToStep(step: StepKind, sessionUrn: string): string {\n\tswitch (step) {\n\t\tcase \"submit\":\n\t\t\treturn toSubmit({ urn: sessionUrn });\n\t\tcase \"analysis\":\n\t\t\treturn toAnalysis({ urn: sessionUrn });\n\t\tcase \"checkout\":\n\t\t\treturn \"/checkout/\";\n\t\tcase \"results\":\n\t\t\treturn toResults({ urn: sessionUrn });\n\t\tdefault:\n\t\t\tassertNever(step);\n\t}\n}\n\nconst STEPS = [\"submit\", \"analysis\", \"checkout\", \"results\"] as const;\n\nexport interface StepSelectorProps {\n\treadonly sessionUrn: string;\n\treadonly current: StepKind;\n\treadonly disableOthers?: boolean;\n}\n\nconst ICONS: Readonly<Record<StepKind, PicaIconKind>> = {\n\tsubmit: \"upload\",\n\tanalysis: \"analyse\",\n\tcheckout: \"checkout\",\n\tresults: \"results\",\n};\n\nconst ENABLE_CHECKOUT = false;\n\nexport function StepSelector({ current, sessionUrn, disableOthers }: StepSelectorProps): JSX.Element {\n\tconst l = useLocalization(locales);\n\n\treturn (\n\t\t<span className={`StepSelector ${Buttons.BUTTON_GROUP}`}>\n\t\t\t{STEPS.filter(step => ENABLE_CHECKOUT || step !== \"checkout\").map(step => {\n\t\t\t\tconst title = l[step];\n\n\t\t\t\tconst disabled = disableOthers && step !== current;\n\t\t\t\tif (disabled) {\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<span key={step} className={`${Buttons.BUTTON} ${Buttons.DISABLED}`} title={title}>\n\t\t\t\t\t\t\t<PicaIcon kind={ICONS[step]} />\n\t\t\t\t\t\t\t<span className=\"text\">{title}</span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\treturn (\n\t\t\t\t\t<Link\n\t\t\t\t\t\tkey={step}\n\t\t\t\t\t\tto={getLinkToStep(step, sessionUrn)}\n\t\t\t\t\t\tclassName={`${Buttons.BUTTON}${step === current ? \" \" + Buttons.ACTIVE : \"\"}`}\n\t\t\t\t\t\ttitle={title}>\n\t\t\t\t\t\t<PicaIcon kind={ICONS[step]} />\n\t\t\t\t\t\t<span className=\"text\">{title}</span>\n\t\t\t\t\t</Link>\n\t\t\t\t);\n\t\t\t})}\n\t\t</span>\n\t);\n}\n\nexport function StepSelectorGroup({\n\tcurrent,\n\tsessionUrn,\n\tdisableOthers,\n\tchildren,\n}: React.PropsWithChildren<StepSelectorProps>): JSX.Element {\n\treturn (\n\t\t<div className=\"StepSelectorGroup\">\n\t\t\t<Group\n\t\t\t\theading={\n\t\t\t\t\t<div className=\"heading-wrapper\">\n\t\t\t\t\t\t<StepSelector current={current} sessionUrn={sessionUrn} disableOthers={disableOthers} />\n\t\t\t\t\t</div>\n\t\t\t\t}>\n\t\t\t\t{children}\n\t\t\t</Group>\n\t\t</div>\n\t);\n}\n\nconst locales: Locales<SimpleString<StepKind>> = {\n\ten: {\n\t\tsubmit: \"Upload\",\n\t\tanalysis: \"Analysis\",\n\t\tcheckout: \"Checkout\",\n\t\tresults: \"Results\",\n\t},\n\tde: {\n\t\tsubmit: \"Hochladen\",\n\t\tanalysis: \"Analyse\",\n\t\tcheckout: \"Kasse\",\n\t\tresults: \"Ergebnisse\",\n\t},\n};\n","import { Session } from \"../generated/v1/services_pb\";\nimport { Item, Timestamp } from \"../generated/v1/types_pb\";\nimport { DeepReadonly } from \"../util\";\n\nexport function cloneSession(session: DeepReadonly<Session.AsObject>): Session.AsObject {\n\treturn JSON.parse(JSON.stringify(session));\n}\n\nexport function createTimestamp(): Timestamp.AsObject {\n\tconst ms = Date.now();\n\treturn {\n\t\tseconds: Math.floor(ms / 1000),\n\t\tnanos: (ms % 1000) * 1000_0000,\n\t};\n}\n\n/**\n * Returns a number < 0 if a < b, returns a number > 0 if a > b, and returns 0 if a = b.\n */\nexport function compareTimestamps(a: DeepReadonly<Timestamp.AsObject>, b: DeepReadonly<Timestamp.AsObject>): number {\n\tif (a.seconds === b.seconds) return a.nanos - b.nanos;\n\treturn a.seconds - b.seconds;\n}\n\nexport function sortSessionItems(items: readonly DeepReadonly<Item.AsObject>[]): DeepReadonly<Item.AsObject>[] {\n\treturn [...items].sort((a, b) => {\n\t\tconst aCreated = a.createdAt;\n\t\tconst bCreated = b.createdAt;\n\n\t\tif (!aCreated && !bCreated) return 0;\n\t\tif (!aCreated) return -1; // a < b\n\t\tif (!bCreated) return +1; // b < a\n\n\t\treturn compareTimestamps(aCreated, bCreated) || a.urn.localeCompare(b.urn);\n\t});\n}\n","import { ResourcePair } from \"../generated/v1/types_pb\";\nimport { EMPTY_MAP, EMPTY_SET } from \"../util\";\nimport { NONE_URN, PicapicaUrn } from \"./urn\";\n\nexport type ItemUrn = string & { readonly __itemUrn?: never };\nexport type CollectionUrn = string & { readonly __itemUrn?: never };\n\nexport class AnalysisConfig {\n\treadonly groupA: ReadonlySet<ItemUrn>;\n\treadonly groupB: ReadonlySet<ItemUrn>;\n\treadonly collections: ReadonlyMap<CollectionUrn, ReadonlySet<ItemUrn>>;\n\n\tconstructor(\n\t\tgroupA: ReadonlySet<ItemUrn>,\n\t\tgroupB: ReadonlySet<ItemUrn>,\n\t\tcollections: ReadonlyMap<CollectionUrn, ReadonlySet<ItemUrn>>\n\t) {\n\t\tthis.groupA = groupA;\n\t\tthis.groupB = groupB;\n\t\tthis.collections = collections;\n\t}\n\n\twithGroupA(groupA: ReadonlySet<ItemUrn>): AnalysisConfig {\n\t\treturn new AnalysisConfig(groupA, this.groupB, this.collections);\n\t}\n\twithGroupB(groupB: ReadonlySet<ItemUrn>): AnalysisConfig {\n\t\treturn new AnalysisConfig(this.groupA, groupB, this.collections);\n\t}\n\twithCollections(collections: ReadonlyMap<CollectionUrn, ReadonlySet<ItemUrn>>): AnalysisConfig {\n\t\treturn new AnalysisConfig(this.groupA, this.groupB, collections);\n\t}\n\twithCollection(collection: CollectionUrn, items: ReadonlySet<ItemUrn>): AnalysisConfig {\n\t\tconst copy = new Map(this.collections);\n\t\tcopy.set(collection, items);\n\t\treturn this.withCollections(copy);\n\t}\n\n\t/**\n\t * Creates a new analysis config from the given collection of resource pairs.\n\t *\n\t * The approach implemented to compress O(n^2) item combinations into 2 O(n) groups is very\n\t * simplistic and works as follows: If a resource pair contains 2 item URNs, then the `a` URN\n\t * will be in group A and the `b` URN will be in group B.\n\t *\n\t * Disappointingly simple, right? Well, it does have a few advantages: It's fast and it doesn't\n\t * lose any combination as a byproduct of the lossy conversion. However, it might cause some\n\t * combinations to be added.\n\t *\n\t * This approach also has the very nice property that:\n\t * `a == fromResourcePairs(a.getResourcePairs())`.\n\t *\n\t * @param pairs\n\t */\n\tstatic fromResourcePairs(\n\t\tpairs: Iterable<ResourcePair | ResourcePair.AsObject>,\n\t\tallItems: ReadonlyArray<ItemUrn>\n\t): AnalysisConfig {\n\t\tconst groupA = new Set<ItemUrn>();\n\t\tconst groupB = new Set<ItemUrn>();\n\t\tconst collections = new Map<CollectionUrn, Set<ItemUrn>>();\n\n\t\tfunction addCollection(collection: CollectionUrn, item: ItemUrn): void {\n\t\t\tlet set = collections.get(collection);\n\t\t\tif (set === undefined) {\n\t\t\t\tset = new Set();\n\t\t\t\tcollections.set(collection, set);\n\t\t\t}\n\t\t\tset.add(item);\n\t\t}\n\t\tfunction toItemUrns(urn: string): ReadonlyArray<ItemUrn> {\n\t\t\tconst type = getPicapicaUrnType(urn);\n\n\t\t\tif (type === \"item\") {\n\t\t\t\treturn [urn];\n\t\t\t} else if (type === \"session\") {\n\t\t\t\treturn allItems;\n\t\t\t} else {\n\t\t\t\treturn [];\n\t\t\t}\n\t\t}\n\n\t\tfor (const pair of pairs) {\n\t\t\tconst [a, b] = pair instanceof ResourcePair ? [pair.getUrnA(), pair.getUrnB()] : [pair.urnA, pair.urnB];\n\n\t\t\tconst aType = getPicapicaUrnType(a);\n\t\t\tconst bType = getPicapicaUrnType(b);\n\n\t\t\tif (aType === \"collection\") {\n\t\t\t\ttoItemUrns(b).forEach(item => addCollection(a, item));\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (bType === \"collection\") {\n\t\t\t\ttoItemUrns(a).forEach(item => addCollection(b, item));\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\ttoItemUrns(a).forEach(item => groupA.add(item));\n\t\t\ttoItemUrns(b).forEach(item => groupB.add(item));\n\t\t}\n\n\t\treturn new AnalysisConfig(groupA, groupB, collections);\n\t}\n\n\t/**\n\t * Returns a list of resource pairs that represents this config.\n\t *\n\t * @returns\n\t */\n\tgetResourcePairs(): ResourcePair[] {\n\t\tconst pairs: ResourcePair[] = [];\n\n\t\tconst pairsA = new Set<ItemUrn>();\n\t\tconst pairsB = new Set<ItemUrn>();\n\n\t\t// add group combinations\n\t\tfor (const a of this.groupA) {\n\t\t\tfor (const b of this.groupB) {\n\t\t\t\tif (a === b) {\n\t\t\t\t\t// same item\n\t\t\t\t} else {\n\t\t\t\t\tpairsA.add(a);\n\t\t\t\t\tpairsB.add(b);\n\t\t\t\t\tpairs.push(new ResourcePair().setUrnA(a).setUrnB(b));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// add items from groups that aren't in any pair\n\t\tfor (const a of this.groupA) {\n\t\t\tif (!pairsA.has(a)) {\n\t\t\t\tpairs.push(new ResourcePair().setUrnA(a).setUrnB(NONE_URN));\n\t\t\t}\n\t\t}\n\t\tfor (const b of this.groupB) {\n\t\t\tif (!pairsB.has(b)) {\n\t\t\t\tpairs.push(new ResourcePair().setUrnA(NONE_URN).setUrnB(b));\n\t\t\t}\n\t\t}\n\n\t\t// add collections\n\t\tfor (const [collection, items] of this.collections) {\n\t\t\tfor (const item of items) {\n\t\t\t\tpairs.push(new ResourcePair().setUrnA(collection).setUrnB(item));\n\t\t\t}\n\t\t}\n\n\t\treturn pairs;\n\t}\n}\n\n// eslint-disable-next-line @typescript-eslint/no-namespace\nexport namespace AnalysisConfig {\n\texport const EMPTY = new AnalysisConfig(EMPTY_SET, EMPTY_SET, EMPTY_MAP);\n}\n\nfunction getPicapicaUrnType(urn: string): PicapicaUrn[\"type\"] | undefined {\n\ttry {\n\t\treturn PicapicaUrn.parse(urn).type;\n\t} catch (error) {\n\t\treturn undefined;\n\t}\n}\n","import { useMemo } from \"react\";\nimport { AnalysisConfig } from \"./session/analysis-config\";\nimport { State } from \"./use-session\";\nimport { EMPTY_ARRAY } from \"./util\";\n\nexport function useAnalysisConfig(state: State): AnalysisConfig {\n\treturn useMemo(() => {\n\t\tif (state.type === \"Ready\") {\n\t\t\treturn AnalysisConfig.fromResourcePairs(\n\t\t\t\tstate.session.comparisonsList ?? EMPTY_ARRAY,\n\t\t\t\tstate.session.itemsList.map(i => i.urn)\n\t\t\t);\n\t\t} else {\n\t\t\treturn AnalysisConfig.EMPTY;\n\t\t}\n\t}, [state]);\n}\n","import { QueryFunctionContext, useQueries, useQuery, UseQueryOptions } from \"react-query\";\nimport { GetDocumentRequest } from \"./generated/v1/services_pb\";\nimport { Document } from \"./generated/v1/types_pb\";\nimport { getSessionClient } from \"./session/client\";\nimport { Urn } from \"./session/urn\";\nimport { DeepReadonly } from \"./util\";\n\ntype QueryData = Document.AsObject | undefined;\ntype QueryKey = readonly [\"collection-document\", string, Urn<\"document\">];\n\nasync function fetchDocument(context: QueryFunctionContext<QueryKey>): Promise<QueryData> {\n\tconst [, sessionUrn, documentUrn] = context.queryKey;\n\n\tconst req = new GetDocumentRequest();\n\treq.setSessionUrn(sessionUrn);\n\treq.setDocumentUrn(documentUrn);\n\n\tconst resp = await getSessionClient().getDocument(req, null);\n\treturn resp.toObject().document;\n}\nfunction getQueryOptions(\n\tsessionUrn: string,\n\tdocumentUrn: Urn<\"document\">\n\t// eslint-disable-next-line @typescript-eslint/ban-types\n): UseQueryOptions<QueryData, unknown, QueryData, QueryKey> & { queryKey: {} } {\n\treturn {\n\t\tqueryKey: [\"collection-document\", sessionUrn, documentUrn],\n\t\tqueryFn: fetchDocument,\n\t\t// collections are an immutable resource, so we don't need to refetch\n\t\trefetchInterval: false,\n\t\trefetchOnMount: false,\n\t\trefetchOnReconnect: false,\n\t\trefetchOnWindowFocus: false,\n\t};\n}\n\nexport function useCollectionDocument(\n\tsessionUrn: string,\n\tdocumentUrn: Urn<\"document\">\n): DeepReadonly<Document.AsObject> | undefined {\n\tconst options = getQueryOptions(sessionUrn, documentUrn);\n\tconst query = useQuery(options.queryKey, options);\n\treturn query.data;\n}\n\nexport function usePreloadCollectionDocuments(sessionUrn: string, documentUrns: readonly Urn<\"document\">[]): void {\n\tuseQueries(documentUrns.map(urn => getQueryOptions(sessionUrn, urn)));\n}\n","import { useQuery } from \"react-query\";\nimport { GetCollectionsRequest } from \"./generated/v1/services_pb\";\nimport { Collection } from \"./generated/v1/types_pb\";\nimport { getSessionClient } from \"./session/client\";\nimport { DeepReadonly } from \"./util\";\n\nexport function useCollections(sessionUrn: string): [collections: DeepReadonly<Collection.AsObject[]> | undefined] {\n\tconst query = useQuery([\"collections\", sessionUrn] as const, {\n\t\t// collections are an immutable resource, so we don't need to refetch\n\t\trefetchInterval: false,\n\t\trefetchOnMount: false,\n\t\trefetchOnReconnect: false,\n\t\trefetchOnWindowFocus: false,\n\n\t\tqueryFn: async () => {\n\t\t\tconst req = new GetCollectionsRequest();\n\t\t\treq.setSessionUrn(sessionUrn);\n\n\t\t\tconst resp = await getSessionClient().getCollections(req, null);\n\t\t\treturn resp.toObject().collectionsList;\n\t\t},\n\t});\n\n\treturn [query.data];\n}\n","import { useState } from \"react\";\nimport { ComputeResultsRequest, Session } from \"./generated/v1/services_pb\";\nimport { useAsyncEffect } from \"./react-util\";\nimport { getSessionClient } from \"./session/client\";\nimport { SessionMutator } from \"./session/mutator\";\nimport { cloneSession, compareTimestamps } from \"./session/util\";\nimport { State, UseSessionArray } from \"./use-session\";\nimport { delay, noop } from \"./util\";\n\nconst mutator: SessionMutator = session => {\n\tif (session.status === Session.ComputeStatus.STATUS_UNDEFINED) {\n\t\t// we want to set the state to RUNNING as soon as possible to indicate progress.\n\t\tconst newSession = cloneSession(session);\n\t\tnewSession.status = Session.ComputeStatus.STATUS_RUNNING;\n\t\treturn newSession;\n\t}\n\n\treturn session;\n};\n\nexport function useComputerResults(state: State, update: UseSessionArray[1]): void {\n\tconst [retryCount, setRetryCount] = useState(0);\n\n\tuseAsyncEffect(\n\t\tasync token => {\n\t\t\tif (state.type !== \"Ready\") return;\n\n\t\t\tconst { session } = state;\n\t\t\tif (session.status === Session.ComputeStatus.STATUS_RUNNING) return;\n\t\t\tif (\n\t\t\t\tsession.status === Session.ComputeStatus.STATUS_COMPLETED ||\n\t\t\t\tsession.status === Session.ComputeStatus.STATUS_FAILED\n\t\t\t) {\n\t\t\t\tconst { computedAt, modifiedAt } = session;\n\t\t\t\tif (compareTimestamps(computedAt!, modifiedAt!) >= 0) {\n\t\t\t\t\t// We have already computed the results since the last time the session was modified\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (retryCount > 0) {\n\t\t\t\t// wait some time and retry\n\t\t\t\tawait delay(3_000);\n\t\t\t\ttoken.checkCanceled();\n\t\t\t}\n\n\t\t\tconst req = new ComputeResultsRequest();\n\t\t\treq.setSessionUrn(session.urn);\n\n\t\t\tconsole.log(\"Compute results\");\n\t\t\tconst action = getSessionClient()\n\t\t\t\t.computeResults(req, null)\n\t\t\t\t.then(\n\t\t\t\t\t() => {\n\t\t\t\t\t\tupdate(action, mutator);\n\t\t\t\t\t\tsetRetryCount(0);\n\t\t\t\t\t},\n\t\t\t\t\te => {\n\t\t\t\t\t\tsetRetryCount(prev => prev + 1);\n\t\t\t\t\t\tthrow e;\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t\t.catch(console.log);\n\t\t},\n\t\tnoop,\n\t\tnoop,\n\t\t[state, update, retryCount, setRetryCount]\n\t);\n}\n","import React, { useMemo } from \"react\";\nimport { Page } from \"../elements/page\";\nimport { CollectionResultsOverview, ItemResultsOverview, ResultsOverview } from \"../elements/results-overview\";\nimport { SessionState } from \"../elements/session-creating-loading\";\nimport { SharedHead } from \"../elements/shared-header\";\nimport { getLinkToStep } from \"../elements/step-selector\";\nimport { Session } from \"../lib/generated/v1/services_pb\";\nimport { Result } from \"../lib/generated/v1/types_pb\";\nimport { Locales, SimpleString } from \"../lib/localization\";\nimport { toResult, toResults } from \"../lib/page-links\";\nimport { dynamicComponent } from \"../lib/react-util\";\nimport { Urn } from \"../lib/session/urn\";\nimport { getLocationSearchParams } from \"../lib/url-params\";\nimport { useAnalysisConfig } from \"../lib/use-analysis-config\";\nimport { useCollections } from \"../lib/use-collections\";\nimport { useComputerResults } from \"../lib/use-compute-results\";\nimport { useLocalization } from \"../lib/use-localization\";\nimport { getSessionUrn, Ready, useLoadSession } from \"../lib/use-session\";\nimport { DeepReadonly, visitType } from \"../lib/util\";\nimport \"./results.scss\";\n\nexport const Head = (): JSX.Element => (\n\t<>\n\t\t<title>Picapica</title>\n\t\t<meta name=\"robots\" content=\"noindex\"></meta>\n\t\t<SharedHead />\n\t</>\n);\n\nexport default dynamicComponent(Results);\n\nfunction Results(): JSX.Element {\n\tconst l = useLocalization(locales);\n\n\tconst [state, update] = useLoadSession();\n\n\t// request computation\n\tuseComputerResults(state, update);\n\n\t// display result\n\tconst [collections] = useCollections(getSessionUrn(state));\n\n\tconst view = getCurrentView();\n\tconst getLinkToResult = (result: DeepReadonly<Result.AsObject>): string => {\n\t\treturn toResult({ urn: result.urn, view: stringifyView(view) });\n\t};\n\n\tconst config = useAnalysisConfig(state);\n\tconst selectedCollections = useMemo(\n\t\t() => [...config.collections].filter(e => e[1].size > 0).map(e => e[0] as Urn<\"collection\">),\n\t\t[config]\n\t);\n\n\tconst onReady = ({ session }: Ready): JSX.Element => {\n\t\tconst current: JSX.Element = visitType(view, {\n\t\t\toverview: () => (\n\t\t\t\t<ResultsOverview\n\t\t\t\t\tsession={session}\n\t\t\t\t\tcollections={collections}\n\t\t\t\t\tselectedCollections={selectedCollections}\n\t\t\t\t\tbackTo={getLinkToStep(\"analysis\", session.urn)}\n\t\t\t\t\titemTo={getLinkToView(session.urn, VIEW_ITEMS)}\n\t\t\t\t\tcollectionTo={collectionUrn => getLinkToView(session.urn, { type: \"collection\", collectionUrn })}\n\t\t\t\t/>\n\t\t\t),\n\t\t\titems: () => (\n\t\t\t\t<ItemResultsOverview\n\t\t\t\t\tsession={session}\n\t\t\t\t\tbackTo={getLinkToView(session.urn, VIEW_OVERVIEW)}\n\t\t\t\t\tresultTo={getLinkToResult}\n\t\t\t\t/>\n\t\t\t),\n\t\t\tcollection: ({ collectionUrn }) => (\n\t\t\t\t<CollectionResultsOverview\n\t\t\t\t\tcollectionUrn={collectionUrn}\n\t\t\t\t\tsession={session}\n\t\t\t\t\tcollections={collections}\n\t\t\t\t\tbackTo={getLinkToView(session.urn, VIEW_OVERVIEW)}\n\t\t\t\t\tresultTo={getLinkToResult}\n\t\t\t\t/>\n\t\t\t),\n\t\t});\n\n\t\tconst running = session.status === Session.ComputeStatus.STATUS_RUNNING;\n\n\t\treturn (\n\t\t\t<>\n\t\t\t\t{current}\n\n\t\t\t\t<p className=\"loading\" style={running ? {} : { opacity: 0, userSelect: \"none\" }}>\n\t\t\t\t\t{l.running}\n\t\t\t\t</p>\n\t\t\t</>\n\t\t);\n\t};\n\n\treturn (\n\t\t<Page className=\"Results\" title={l.title} header=\"small\">\n\t\t\t<SessionState state={state} onReady={onReady} />\n\t\t</Page>\n\t);\n}\n\ntype View =\n\t| { readonly type: \"overview\" }\n\t| { readonly type: \"items\" }\n\t| { readonly type: \"collection\"; readonly collectionUrn: string };\nconst VIEW_OVERVIEW: View = { type: \"overview\" };\nconst VIEW_ITEMS: View = { type: \"items\" };\n\nfunction parseView(view: string): View {\n\tif (view) {\n\t\tif (view === \"items\") {\n\t\t\treturn VIEW_ITEMS;\n\t\t}\n\n\t\tconst m = /^collection:([^]+)$/.exec(view);\n\t\tif (m) {\n\t\t\treturn { type: \"collection\", collectionUrn: m[1] };\n\t\t}\n\t}\n\n\treturn VIEW_OVERVIEW;\n}\nfunction stringifyView(view: View): string | undefined {\n\tif (view.type === \"items\") {\n\t\treturn \"items\";\n\t} else if (view.type === \"collection\") {\n\t\treturn `collection:${view.collectionUrn}`;\n\t} else {\n\t\treturn undefined;\n\t}\n}\n\nfunction getCurrentView(): View {\n\tconst view = getLocationSearchParams().get(\"view\");\n\treturn view ? parseView(view) : VIEW_OVERVIEW;\n}\nfunction getLinkToView(sessionUrn: string, view: View): string {\n\treturn toResults({ urn: sessionUrn, view: stringifyView(view) });\n}\n\nconst locales: Locales<SimpleString<\"title\" | \"running\">> = {\n\ten: {\n\t\ttitle: \"Results - Picapica\",\n\n\t\trunning: \"Your submitted files are currently being processed. This might take a few seconds.\",\n\t},\n\tde: {\n\t\ttitle: \"Ergebnisse - Picapica\",\n\n\t\trunning: \"Ihre Eingabe wird bearbeitet. Dies kann ein paar Sekunden dauern.\",\n\t},\n};\n"],"names":["CenterAlignTwo","className","grow","knownCollections","en","core_fulltext_languagenameenglish","title","de","EMPTY_OBJ","Label","props","kind","SubmittedFilesLabel","l","useLocalization","icon","text","CollectionLabel","urn","PicapicaUrn","collection","urnString","parsed","c","processProps","known","useCollectionLocalization","name","description","locales","submittedFiles","unknown","LoaderAnimation","id","categorizeResults","results","categories","items","collections","invalid","addDocument","collectionUrn","type","collectionId","document","list","a","result","b","Badge","OverviewContainer","backTo","Buttons","to","ResultsOverview","session","console","left","right","running","Session","key","sessionUrn","collectionTo","usePreloadCollectionDocuments","r","ItemResultsOverview","itemNameMap","Map","item","leftName","rightName","resultTo","CollectionResultsOverview","itemName","documentName","useCollectionDocument","back","analysisResults","matches","noResults","unknownItem","Group","getLinkToStep","step","toSubmit","toAnalysis","toResults","assertNever","STEPS","ICONS","submit","analysis","checkout","StepSelector","disableOthers","StepSelectorGroup","heading","current","cloneSession","JSON","createTimestamp","ms","Date","seconds","Math","nanos","compareTimestamps","sortSessionItems","aCreated","bCreated","AnalysisConfig","constructor","this","groupA","groupB","withGroupA","withGroupB","withCollections","withCollection","copy","addCollection","set","getPicapicaUrnType","allItems","pair","aType","bType","toItemUrns","getResourcePairs","pairs","pairsA","pairsB","useAnalysisConfig","state","useMemo","fromResourcePairs","i","EMPTY","async","fetchDocument","context","req","getSessionClient","resp","queryKey","queryFn","refetchInterval","refetchOnMount","refetchOnReconnect","refetchOnWindowFocus","options","getQueryOptions","useQuery","useQueries","documentUrns","useCollections","mutator","newSession","Head","content","dynamicComponent","update","useLoadSession","retryCount","useState","useAsyncEffect","computedAt","delay","token","action","setRetryCount","e","prev","useComputerResults","getSessionUrn","view","getLocationSearchParams","VIEW_ITEMS","m","exec","VIEW_OVERVIEW","parseView","getCurrentView","getLinkToResult","toResult","stringifyView","config","selectedCollections","header","onReady","visitType","overview","itemTo","getLinkToView","style","opacity","userSelect"],"sourceRoot":""}