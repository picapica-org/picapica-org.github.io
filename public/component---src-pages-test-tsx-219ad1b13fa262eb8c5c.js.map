{"version":3,"file":"component---src-pages-test-tsx-219ad1b13fa262eb8c5c.js","mappings":"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","sources":["webpack://picapica-web-client/./src/elements/alignment-view.tsx","webpack://picapica-web-client/./src/lib/lru-cache.ts","webpack://picapica-web-client/./src/lib/use-alignment.ts","webpack://picapica-web-client/./src/pages/test.tsx"],"sourcesContent":["import React, { memo } from \"react\";\nimport { LeftChange, RightChange } from \"../lib/alignment\";\nimport { Locales } from \"../lib/localization\";\nimport { useAlignment } from \"../lib/use-alignment\";\nimport { useLocalization } from \"../lib/use-localization\";\nimport \"./alignment-view.scss\";\n\nexport interface Props {\n\treadonly left: string;\n\treadonly right: string;\n\treadonly alignmentKey: string;\n}\n\nexport const AlignmentView = memo((props: Props): JSX.Element => {\n\tconst [alignments] = useAlignment(props.alignmentKey, [props]);\n\n\tconst diff = alignments[0]?.diff?.diff;\n\n\treturn (\n\t\t<div className=\"AlignmentView\">\n\t\t\t{diff ? (\n\t\t\t\t<>\n\t\t\t\t\t{diff.map(({ left }, i) => {\n\t\t\t\t\t\treturn <DiffView key={\"l\" + i} left={left} index={i} total={diff.length} />;\n\t\t\t\t\t})}\n\t\t\t\t\t{diff.map(({ right }, i) => {\n\t\t\t\t\t\treturn <DiffView key={\"r\" + i} right={right} index={i} total={diff.length} />;\n\t\t\t\t\t})}\n\t\t\t\t</>\n\t\t\t) : (\n\t\t\t\t<>\n\t\t\t\t\t<div className=\"left\" style={{ gridRow: 1 }}>\n\t\t\t\t\t\t<span>{props.left}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"right\" style={{ gridRow: 1 }}>\n\t\t\t\t\t\t<span>{props.right}</span>\n\t\t\t\t\t</div>\n\t\t\t\t</>\n\t\t\t)}\n\t\t</div>\n\t);\n});\n\ninterface DiffLineProps {\n\tindex: number;\n\ttotal: number;\n}\nfunction DiffView(props: ({ left: LeftChange<string> } | { right: RightChange<string> }) & DiffLineProps): JSX.Element {\n\tlet equal: string;\n\tlet changed: string;\n\tlet type: \"left\" | \"right\";\n\tif (\"left\" in props) {\n\t\tequal = props.left.equal;\n\t\tchanged = props.left.removed;\n\t\ttype = \"left\";\n\t} else {\n\t\tequal = props.right.equal;\n\t\tchanged = props.right.added;\n\t\ttype = \"right\";\n\t}\n\n\tconst changedClass = type === \"left\" ? \"removed\" : \"added\";\n\n\treturn (\n\t\t<div className={type} style={{ gridRow: props.index + 1 }}>\n\t\t\t{equal !== \"\" ? (\n\t\t\t\t<>\n\t\t\t\t\t<span className=\"unchanged\">{equal.trim()}</span>\n\t\t\t\t\t{/\\s$/.test(equal) ? \" \" : \"\"}\n\t\t\t\t\t<Change {...props} type={changedClass} text={changed} isFirst={false} />\n\t\t\t\t</>\n\t\t\t) : (\n\t\t\t\t<Change {...props} type={changedClass} text={changed} isFirst={true} />\n\t\t\t)}\n\t\t</div>\n\t);\n}\n\ninterface ChangeProps {\n\ttext: string;\n\ttype: \"added\" | \"removed\";\n\tindex: number;\n\ttotal: number;\n\tisFirst: boolean;\n}\nfunction Change(props: ChangeProps): JSX.Element {\n\tconst text = props.text;\n\n\tconst context = 500;\n\tconst minOmitted = 20;\n\n\tconst isLast = props.index === props.total - 1;\n\tif (isLast && text.length > context) {\n\t\tconst tokens = tokenizeWords(text);\n\t\tconst rest = splitRest(tokens, context);\n\t\tif (rest.length > minOmitted) {\n\t\t\treturn (\n\t\t\t\t<>\n\t\t\t\t\t<span className={props.type}>\n\t\t\t\t\t\t<FadeText text={tokens.join(\" \").trim()} position=\"end\" />\n\t\t\t\t\t</span>\n\t\t\t\t\t<Omitted words={rest.length} />\n\t\t\t\t</>\n\t\t\t);\n\t\t}\n\t} else if (props.isFirst && text.length > context) {\n\t\tconst tokens = tokenizeWords(text).reverse();\n\t\tconst rest = splitRest(tokens, context);\n\t\tif (rest.length > minOmitted) {\n\t\t\treturn (\n\t\t\t\t<>\n\t\t\t\t\t<Omitted words={rest.length} />\n\t\t\t\t\t<span className={props.type}>\n\t\t\t\t\t\t<FadeText text={tokens.reverse().join(\" \").trim()} position=\"start\" />\n\t\t\t\t\t</span>\n\t\t\t\t</>\n\t\t\t);\n\t\t}\n\t} else if (text.length > context * 2) {\n\t\tconst start = tokenizeWords(text);\n\t\tconst end = splitRest(start, context).reverse();\n\t\tconst rest = splitRest(end, context);\n\n\t\tif (rest.length > minOmitted) {\n\t\t\treturn (\n\t\t\t\t<>\n\t\t\t\t\t<span className={props.type}>\n\t\t\t\t\t\t<FadeText text={start.join(\" \").trim()} position=\"end\" />\n\t\t\t\t\t</span>\n\t\t\t\t\t<Omitted words={rest.length} />\n\t\t\t\t\t<span className={props.type}>\n\t\t\t\t\t\t<FadeText text={end.reverse().join(\" \").trim()} position=\"start\" />\n\t\t\t\t\t</span>\n\t\t\t\t</>\n\t\t\t);\n\t\t}\n\t}\n\n\treturn <span className={props.type}>{props.text}</span>;\n}\nfunction tokenizeWords(text: string): string[] {\n\treturn text.split(/ /g);\n}\nfunction splitRest(tokens: string[], stringLength: number): string[] {\n\tlet length = 0;\n\tfor (let i = 0; i < tokens.length; i++) {\n\t\tlength += tokens[i].length;\n\t\tif (length >= stringLength) {\n\t\t\treturn tokens.splice(i + 1, tokens.length - i - 1);\n\t\t}\n\t}\n\n\treturn [];\n}\n\ninterface FadeTextProps {\n\ttext: string;\n\tposition: \"start\" | \"end\";\n}\nfunction FadeText(props: FadeTextProps): JSX.Element {\n\tconst fadeLength = 10;\n\n\tconst chars = [...props.text];\n\tif (chars.length < fadeLength) {\n\t\t// fail safe\n\t\treturn <>{props.text}</>;\n\t}\n\n\tconst fade =\n\t\tprops.position === \"start\" ? chars.splice(0, fadeLength) : chars.splice(chars.length - fadeLength, fadeLength);\n\tconst text = chars.join(\"\");\n\n\tif (props.position === \"start\") {\n\t\treturn (\n\t\t\t<>\n\t\t\t\t{fade.map((c, i) => (\n\t\t\t\t\t<span key={i} className=\"fade\" style={{ opacity: i / fadeLength }}>\n\t\t\t\t\t\t{c}\n\t\t\t\t\t</span>\n\t\t\t\t))}\n\t\t\t\t{text}\n\t\t\t</>\n\t\t);\n\t} else {\n\t\treturn (\n\t\t\t<>\n\t\t\t\t{text}\n\t\t\t\t{fade.map((c, i) => (\n\t\t\t\t\t<span key={i} className=\"fade\" style={{ opacity: (fadeLength - i) / fadeLength }}>\n\t\t\t\t\t\t{c}\n\t\t\t\t\t</span>\n\t\t\t\t))}\n\t\t\t</>\n\t\t);\n\t}\n}\n\ninterface OmittedProps {\n\twords: number;\n}\nfunction Omitted(props: OmittedProps): JSX.Element {\n\tconst l = useLocalization(locales);\n\treturn <span className=\"Omitted\"> [{l.omitted(props.words)}] </span>;\n}\n\nconst locales: Locales<{\n\tomitted: (words: number) => JSX.Element;\n}> = {\n\ten: {\n\t\tomitted(words) {\n\t\t\treturn <>… {words} words omitted</>;\n\t\t},\n\t},\n\tde: {\n\t\tomitted(words) {\n\t\t\treturn <>… {words} Wörter weggelassen</>;\n\t\t},\n\t},\n};\n","/**\n * Shuffles the given array.\n */\nfunction shuffle<T>(array: T[]): void {\n\tlet j, x, i;\n\tfor (i = array.length - 1; i > 0; i--) {\n\t\tj = Math.floor(Math.random() * (i + 1));\n\t\tx = array[i];\n\t\tarray[i] = array[j];\n\t\tarray[j] = x;\n\t}\n}\n\n/**\n * Returns a random subset of the given values with `min(count, values.length)` elements.\n *\n * @param values\n * @param count\n * @returns\n */\nfunction randomValues<T>(values: readonly T[], count: number): T[] {\n\tif (values.length <= count) return values.slice(0);\n\tif (count === 1) return [values[Math.floor(Math.random() * values.length)]];\n\n\tconst copy = values.slice(0);\n\tshuffle(copy);\n\treturn copy.slice(0, count);\n}\n\n/**\n * A least recently used cache.\n */\nexport class LRUCache<V> {\n\tsize: number;\n\n\tprivate _length: number;\n\tprivate _head: CacheNode<string, V>;\n\tprivate _tail: CacheNode<string, V>;\n\tprivate _map: Record<string, CacheNode<string, V>> = {};\n\n\t/**\n\t * Creates an instance of LRUCache.\n\t *\n\t * @param size The maximum size of the cache.\n\t */\n\tconstructor(size = 100) {\n\t\tthis.size = size;\n\t\tthis._length = 0;\n\n\t\tthis._head = new CacheNode<string, V>(null as any, null as any);\n\t\tthis._tail = new CacheNode<string, V>(null as any, null as any);\n\t\tthis._head.next = this._tail;\n\t\tthis._tail.prev = this._head;\n\t}\n\n\t/**\n\t * Adds a new element to the cache.\n\t *\n\t * @param key The key of the element.\n\t * @param obj The element.\n\t */\n\tadd(key: string, obj: V): void {\n\t\treturn this.addAll({ [key]: obj });\n\t}\n\t/**\n\t * Adds any number of key-value-pairs to the cache.\n\t *\n\t * @param map The collection of key-value-pairs.\n\t */\n\taddAll(map: Record<string, V>): void {\n\t\tlet keys = Object.keys(map);\n\t\tif (keys.length === 0) return;\n\t\tif (keys.length > this.size) keys = keys.slice(0, this.size);\n\n\t\tconst toRemove = keys.length + this._length - this.size;\n\t\tif (toRemove > 0) {\n\t\t\trandomValues(Object.keys(this._map), toRemove).forEach(key => {\n\t\t\t\tthis.remove(key);\n\t\t\t});\n\t\t}\n\n\t\tfor (const key of keys) {\n\t\t\tconst node = new CacheNode<string, V>(key, map[key]);\n\t\t\tthis._tail.insertBefore(node);\n\t\t\tthis._map[key] = node;\n\t\t\tthis._length++;\n\t\t}\n\t}\n\n\t/**\n\t * Returns the cached value.\n\t *\n\t * @param key The key of the cached element.\n\t * @param defaultValue The default value.\n\t * @returns The cached element of the default value.\n\t */\n\tget(key: string, defaultValue: V): V;\n\tget(key: string, defaultValue?: V): V | undefined;\n\tget(key: string, defaultValue?: V): V | undefined {\n\t\tconst node = this._map[key];\n\t\tif (node) {\n\t\t\tnode.remove();\n\t\t\tthis._head.insertAfter(node);\n\t\t\treturn node.obj;\n\t\t} else {\n\t\t\treturn defaultValue;\n\t\t}\n\t}\n\n\t/**\n\t * Returns whether an element with the given key is cached.\n\t *\n\t * @param key The key of the cached element.\n\t * @returns\n\t */\n\tcontains(key: string): boolean {\n\t\treturn Boolean(this._map[key]);\n\t}\n\n\t/**\n\t * Removes the cached element with the given key.\n\t *\n\t * @param key The key of the cached element.\n\t * @returns Whether there was an element cached.\n\t */\n\tremove(key: string): boolean {\n\t\tconst node = this._map[key];\n\t\tif (!node) return false;\n\t\tthis._removeNode(node);\n\t\treturn true;\n\t}\n\n\t_removeNode(node: CacheNode<string, V>): void {\n\t\tthis._length--;\n\t\tdelete this._map[node.key];\n\t\tnode.remove();\n\t}\n}\n\n/**\n * A node used by the internal implementation of the LRU cache.\n */\nclass CacheNode<K, V> {\n\tkey: K;\n\tobj: V;\n\n\tprev: CacheNode<K, V> | undefined = undefined;\n\tnext: CacheNode<K, V> | undefined = undefined;\n\n\tconstructor(key: K, obj: V) {\n\t\tthis.key = key;\n\t\tthis.obj = obj;\n\t}\n\n\tremove(): void {\n\t\tthis.prev!.next = this.next;\n\t\tthis.next!.prev = this.prev;\n\t}\n\n\tinsertAfter(afterNode: CacheNode<K, V>): void {\n\t\tafterNode.next = this.next;\n\t\tafterNode.prev = this;\n\n\t\tthis.next!.prev = afterNode;\n\t\tthis.next = afterNode;\n\t}\n\tinsertBefore(beforeNode: CacheNode<K, V>): void {\n\t\treturn this.prev!.insertAfter(beforeNode);\n\t}\n}\n","import { useEffect, useState } from \"react\";\nimport { SimpleCombinedDiff } from \"./alignment\";\nimport { LRUCache } from \"./lru-cache\";\nimport { useAsyncEffect } from \"./react-util\";\nimport { lazy, noop } from \"./util\";\n\nlet pendingResolvesCounter = 0;\nconst pendingResolves = new Map<number, (diff: SimpleCombinedDiff) => void>();\n\nconst getWorker = lazy(() => {\n\tconst worker = new Worker(new URL(\"./alignment.worker.ts\", import.meta.url));\n\tworker.onmessage = ({ data: { diff, id } }) => {\n\t\tconst resolve = pendingResolves.get(id);\n\t\tpendingResolves.delete(id);\n\t\tif (resolve) {\n\t\t\tresolve(diff);\n\t\t}\n\t};\n\treturn worker;\n});\n\nconst promiseCache = new LRUCache<Promise<SimpleCombinedDiff>>(500);\nconst resultCache = new LRUCache<SimpleCombinedDiff>(500);\n\nfunction getCacheKey(left: string, right: string): string {\n\treturn left + \"\\0\" + right;\n}\nfunction getSimpleCombinedDiff(left: string, right: string): Promise<SimpleCombinedDiff> {\n\tconst key = getCacheKey(left, right);\n\tlet promise = promiseCache.get(key);\n\tif (promise === undefined) {\n\t\tpromise = new Promise<SimpleCombinedDiff>(resolve => {\n\t\t\tconst id = pendingResolvesCounter++;\n\t\t\tpendingResolves.set(id, resolve);\n\t\t\tgetWorker().postMessage({ left, right, id });\n\t\t});\n\t\tpromiseCache.add(key, promise);\n\t\tpromise.then(diff => resultCache.add(key, diff));\n\t}\n\treturn promise;\n}\nfunction getCachedSimpleCombinedDiff(left: string, right: string): SimpleCombinedDiff | undefined {\n\tconst key = getCacheKey(left, right);\n\treturn resultCache.get(key);\n}\n\nexport interface AlignmentRequest {\n\tleft: string;\n\tright: string;\n}\nexport interface Alignment {\n\treadonly left: string;\n\treadonly right: string;\n\tdiff: SimpleCombinedDiff | undefined;\n}\n\n/**\n * Returns the alignments for some strings.\n *\n * The purpose of this hooks is to provide a convenient way to use a web worker to compute the alignment.\n *\n * @param key\n * @param requests\n * @returns\n */\nexport function useAlignment(key: string, requests: readonly AlignmentRequest[]): [readonly Alignment[]] {\n\tconst [requestsKey, setRequestsKey] = useState(key);\n\tconst [state, setState] = useState<readonly Alignment[]>(() => GetInitialAlignments(requests));\n\n\tuseEffect(() => {\n\t\tif (key !== requestsKey) {\n\t\t\tsetRequestsKey(key);\n\t\t\tsetState(GetInitialAlignments(requests));\n\t\t}\n\t}, [key, requestsKey, requests]);\n\n\tuseAsyncEffect<readonly Alignment[] | undefined>(\n\t\tasync token => {\n\t\t\t// all alignments are computed\n\t\t\tif (state.every(a => a.diff !== undefined)) return;\n\n\t\t\tconst newState = [...state];\n\n\t\t\t// try to fill-in as many cached results as possible\n\t\t\tfor (let i = 0; i < state.length; i++) {\n\t\t\t\tconst alignment = state[i];\n\t\t\t\tif (alignment.diff === undefined) {\n\t\t\t\t\tconst diff = getCachedSimpleCombinedDiff(alignment.left, alignment.right);\n\t\t\t\t\tif (diff !== undefined) {\n\t\t\t\t\t\tnewState[i] = { ...alignment, diff };\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// compute at most one diff\n\t\t\tfor (let i = 0; i < state.length; i++) {\n\t\t\t\tconst alignment = state[i];\n\t\t\t\tif (alignment.diff === undefined) {\n\t\t\t\t\tnewState[i] = { ...alignment, diff: await getSimpleCombinedDiff(alignment.left, alignment.right) };\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn newState;\n\t\t},\n\t\tnewState => {\n\t\t\tif (newState) {\n\t\t\t\tsetState(newState);\n\t\t\t}\n\t\t},\n\t\tnoop,\n\t\t[state]\n\t);\n\n\treturn [state];\n}\n\nfunction GetInitialAlignments(requests: readonly AlignmentRequest[]): readonly Alignment[] {\n\treturn requests.map(r => {\n\t\treturn { left: r.left, right: r.right, diff: getCachedSimpleCombinedDiff(r.left, r.right) };\n\t});\n}\n","import React from \"react\";\nimport { Helmet } from \"react-helmet\";\nimport { AlignmentView } from \"../elements/alignment-view\";\nimport { Page } from \"../elements/page\";\nimport { SharedHead } from \"../elements/shared-header\";\nimport { Item } from \"../lib/generated/v1/types_pb\";\nimport { dynamic } from \"../lib/react-util\";\nimport { DeepRequired } from \"../lib/util\";\nimport \"./legal.scss\";\n\nexport default function TestPage(): JSX.Element {\n\treturn (\n\t\t<>\n\t\t\t{dynamic(() => (\n\t\t\t\t<Test />\n\t\t\t))}\n\t\t\t<SharedHead />\n\t\t\t<Helmet>\n\t\t\t\t<title>Picapica</title>\n\t\t\t</Helmet>\n\t\t</>\n\t);\n}\n\nfunction Test(): JSX.Element {\n\tconst foo: DeepRequired<Item.Resource.AsObject> = {\n\t\titemUrn: \"asdasdasd\",\n\t\ttype: 3,\n\t\tstatus: Item.Resource.ProcessingStatus.STATUS_COMPLETED,\n\t\trawProperties: { checksum: \"\", size: 4 },\n\t\ttextProperties: { checksum: \"\", length: 4 },\n\t};\n\treturn (\n\t\t<Page className=\"Test\" header=\"small\">\n\t\t\t<AlignmentView alignmentKey=\"fake-key\" left={testA} right={testB} />\n\t\t\t{foo.itemUrn}\n\t\t</Page>\n\t);\n}\n\nconst testA = `commanders on both sides, like Lord Kitchener, predicted the war would be a long one. Other political leaders, such as Bethmann Hollweg in Germany, were concerned by the potential social consequences of a war. International bond and financial markets entered severe crises in late July and early August reflecting worry about the financial consequences of war. The perceived excitement of war captured the imagination of many in the warring nations. Spurred on by propaganda and nationalist fervor, many eagerly joined the ranks in search of adventure. Few were prepared for what they actually encountered at the front. See also: Recruitment to the British Army during WW I Trench warfare begins See main article: Western Front (World War I) After their initial success on the Marne, Entente and German forces began a series of outflanking manoeuvres to try to force the other to retreat, in the so-called Race to the Sea. Britain and France soon found themselves facing entrenched German positions from Lorraine to Belgium's Flemish coast. The British and French sought to take the offensive while Germany sought to defend the territories it had occupied. One consequence of this was that the German trenches were much better constructed than those of their enemy: the Anglo-French trenches were only intended to be 'temporary' before their forces broke through the German defences. In April 1915,the Germans used mustard gas for the first time,opening a 4 mile wide hole in the Allied lines when French colonial troops retreated from it. This breach was closed by Canadian soldiers. Neither side proved able to deliver a decisive blow for the next four years, though protracted German action at Verdun throughout (1916), and the Entente's failure at the Somme in the summer of 1916 brought the French army to the brink of collapse. Futile attempts at more frontal assaults, at terrible cost to the French poilu infantry, led to mutinies which threatened the integrity of the front line in 1917 after the Nivelle Offensive in the spring of 1917. News of the Russian Revolution gave a new incentive to socialist sentiments. Red flags were hoisted and the Internationale was sung on several occasions. At the height of the mutiny, 30,000 to 40,000 French soldiers participated. Throughout 1915-17 the British Empire and French armies suffered many more casualties than the German one, but both sides lost millions of soldiers to injury and disease. Around 800,000 soldiers from the British Empire were on the Western Front`;\nconst testB = `Main article: Western Front (World War I) Trench warfare begins Trenches of the 11th Cheshire Regiment at Ovillers-la-Boisselle, on the Somme, July 1916 Military tactics which were developed before World War I failed to keep pace with advances in technology and had become obsolete. These advances had allowed the creation of strong defensive systems, which out-of-date military tactics could not break through for most of the war. Barbed wire was a significant hindrance to massed infantry advances, while artillery, vastly more lethal than in the 1870s, coupled with machine guns, made crossing open ground extremely difficult.[95] Commanders on both sides failed to develop tactics for breaching entrenched positions without heavy casualties. In time, however, technology began to produce new offensive weapons, such as gas warfare and the tank.[96] After the First Battle of the Marne (5–12 September 1914), Allied and German forces unsuccessfully tried to outflank each other, a series of manoeuvres later known as the \"Race to the Sea\". By the end of 1914, the opposing forces were left confronting each other along an uninterrupted line of entrenched positions from Alsace to Belgium's North Sea coast.[14] Since the Germans were able to choose where to stand, they normally had the advantage of the high ground; in addition, their trenches tended to be better built, since Anglo-French trenches were initially intended as \"temporary,\" and would only be needed until the breaking of German defences.[97] Both sides tried to break the stalemate using scientific and technological advances. On 22 April 1915, at the Second Battle of Ypres, the Germans (violating the Hague Convention) used chlorine gas for the first time on the Western Front. Several types of gas soon became widely used by both sides, and though it never proved a decisive, battle-winning weapon, poison gas became one of the most-feared and best-remembered horrors of the war.[98] [99] Tanks were developed by Britain and France and were first used in combat by the British during the Battle of Flers–Courcelette (part of the Battle of the Somme) on 15 September 1916, with only partial success. However, their effectiveness would grow as the war progressed; the Allies built tanks in large numbers, whilst the Germans employed only a few of their own design, supplemented by captured Allied tanks. Continuation of trench warfare French 87th regiment near Verdun, 1916 Neither side proved able to deliver a decisive blow for the next two years. Throughout 1915–17, the British Empire and`;\n"],"names":["AlignmentView","memo","props","alignments","useAlignment","alignmentKey","diff","className","map","left","i","DiffView","key","index","total","length","right","style","gridRow","equal","changed","type","removed","added","changedClass","trim","test","Change","text","isFirst","context","tokens","tokenizeWords","rest","splitRest","FadeText","join","position","Omitted","words","reverse","start","end","split","stringLength","splice","fadeLength","chars","fade","c","opacity","l","useLocalization","locales","omitted","en","de","randomValues","values","count","slice","Math","floor","random","copy","array","j","x","shuffle","LRUCache","_map","constructor","size","this","_length","_head","CacheNode","_tail","next","prev","add","obj","addAll","keys","Object","toRemove","forEach","remove","node","insertBefore","get","defaultValue","insertAfter","contains","Boolean","_removeNode","undefined","afterNode","beforeNode","pendingResolvesCounter","pendingResolves","Map","getWorker","lazy","worker","Worker","URL","onmessage","data","id","resolve","delete","promiseCache","resultCache","getCacheKey","getSimpleCombinedDiff","promise","Promise","set","postMessage","then","getCachedSimpleCombinedDiff","requests","requestsKey","setRequestsKey","useState","state","setState","GetInitialAlignments","useEffect","useAsyncEffect","async","every","a","newState","alignment","noop","r","TestPage","dynamic","Test","foo","Item","header","testA","testB"],"sourceRoot":""}